<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A visual introduction to probability and statistics.">
    <meta name="author" content="--">
    <title>Xavier Initialization</title>
    <!-- Fonts -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Assistant:300,400,600,700" rel="stylesheet">
    <!-- Home Page CSS -->
    <link rel="stylesheet" type="text/css" href="css/template.css">
    <!--Favicon-->
    <link rel="shortcut icon" type="image/png" href="img/favicon.png" />
    <!-- Load jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Load D3 -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- Load Deeplearn -->
    <script src="https://unpkg.com/deeplearn@latest"></script>
    <!-- Load Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>

</head>

<body>
    <div class="header"></div>
    <div class="main divider-bottom">
        <div class="container">
            <div class="column-6-8 column-align">
                <h1 class="title">Xavier Initialization</h1>
                <h2>The lack of initialization techniques is one of the major reasons deep neural networks weren’t training properly in the past decades. Since then, new initializations schemes have been found to accelerate training. In this post, we will explain the methods to initialize the parameters of your neural network.</h2>
            </div>
            <div class="column-2-8 column-align">
                <ul>Table of content
                    <li>Problem statement</li>
                    <li>What are the issues with a bad initialization?</li>
                    <li>Exploding Gradient</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="container">
            <div class="column-8-8 divider-bottom">
                <h3>Problem statement</h3>
                <p>A neural network model is defined by its <i>architecture</i> and its <i>parameters</i>. In order to build a cat classifier with a 3-layer neural network (architecture), you need to learn the parameters using the optimization process:
                </p>
                <ol>
                    <li>Initialize the parameters</li>
                    <li>Use an optimization algorithm, repeat:</li>
                    <ol>
                        <li>Forward propagate an input image</li>
                        <li>Compute the cost</li>
                        <li>Backward propagation the gradients</li>
                        <li>Update the parameters using gradient descent (for example)</li>
                    </ol>
                </ol>
                <p>
                Given a new image, you can then use your model (architecture + learned parameters) to predict if there’s a cat.
                </p>
                <p>
                To illustrate our argumentation let’s consider this 3-layer neural network. You can play with different initialization scheme and observe their impact on the learning.
                </p>
            </div>
            <div class="column-2-8 column-align">
                <h3>Input Data</h3>
                <p>Choose a dataset as input to the neural network and select whether to view weights or gradients.</p>
                <label class="radio-container">Gradients
                    <input type="radio" value="gradient" name="link">
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Weights
                    <input type="radio" value="weight" name="link" checked>
                    <span class="checkmark"></span>
                </label>
            </div>
            <div class="column-4-8 column-align">
                <h3>Neural Network</h3>
                <p>Select a variance to initialize weights with.</p>
                <label class="radio-container">All Zeros
                    <input type="radio" value=0  name="init">
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Too Small
                    <input type="radio" value=0.01 name="init">
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Xe Initialization
                    <input type="radio" value=1 name="init" checked>
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Too Large
                    <input type="radio" value=100 name="init">
                    <span class="checkmark"></span>
                </label>
            </div>
            <div class="column-2-8 column-align">
                <h3>Output Classification</h3>
                <p>Train model.</p>
                <div>
                    <button class="button" id="reset">Reset</button>
                    <button class="button" id="train">Train</button>
                </div>
            </div>
            <div class="column-2-8 column-align lg-screen-img">
                <div id="datasets"></div>
                <div id="legend"></div>
            </div>
            <div class="column-4-8 column-align lg-screen-img">
                <div id="network"></div>
            </div>
            <div class="column-2-8 column-align lg-screen-img">
                <div id="loss"></div>
                <div id="prediction"></div>
            </div>
            <div class="column-6-8 column-align">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
            <div class="column-2-8 column-align">
                <p class="caption">Zero initialization doesn’t work because it lacks at breaking the symmetry.</p>
            </div>
            <div class="column-8-8 divider-bottom"></div>
            <div class="column-6-8">
                <h3>What are the issues with a bad initialization?</h3>
                <p>An inappropriate initialization leads to:</p>
                <ol>
                    <li>Vanishing gradient -> parameters values get stuck</li>
                    <li>Exploding gradients -> parameters values diverge</li>
                </ol>
                <p>In both cases, parameters do not converge to “good” values. Let’s illustrate this.</p>
                <p>Consider this 9-layer neural network just after it was initialized.</p>
                <img src="img/9layer.png">
                <p>At every iteration of the optimization loop (forward, cost, backward, update), we observe that back-propagated gradients are either amplified or minified as we move from the output layer towards the input layer. This makes sense if you recall the following: Assuming all the activation functions are linear (identity function), the output activation is:</p>
                <script>
                    var render = katex.renderToString("\\hat{y} = a^{[L]} = W^{[L]}W^{[L-1]}W^{[L-2]}\\dots W^{[3]}W^{[2]}W^{[1]}X", {displayMode: true});
                    document.writeln(render);
                </script>
            </div>
        </div>
        <div class="container">
            <div class="column-6-8 divider-bottom"></div>
            <div class="column-4-8 ">
                <h3>Exploding Gradient</h3></div>
            <div class="column-4-8 column-align">
                <p>Consider the case where every weight is initialized slightly larger than the identity matrix.</p> 
                <script>
                    var render = katex.renderToString("W^{[1]} = W^{[2]} = \\dots = W^{[L-1]}=\\begin{bmatrix}1.5 & 0 \\cr 0 & 1.5\\end{bmatrix}", {displayMode: true});
                    document.writeln(render);
                </script>
                <p>This simplifies to __, and the values of the activation __ increase exponentially with __. When these activations are used in backward propagation, this leads to the exploding gradient problem that you could visualize on the contour plot of the loss as:</p>
            </div>
            <div class="column-4-8 column-align">
                <img src="img/exploding.png">
            </div>
            <div class="column-4-8">
                <h3>Vanishing Gradient</h3>

            </div>

            <div class="column-4-8 column-align">
                <p>Similarly, consider the case where every weight is initialized slightly smaller than the identity matrix.</p>
                <script>
                    var render = katex.renderToString("W^{[1]} = W^{[2]} = \\dots = W^{[L-1]}=\\begin{bmatrix}0.5 & 0 \\cr 0 & 0.5\\end{bmatrix}", {displayMode: true});
                    document.writeln(render);
                </script>
                <p>This simplifies to __, and the values of the activation __  decreases exponentially with __. When these activations are used in backward propagation, this leads to the vanishing gradient problem that you could visualize on the contour plot of the loss as:</p>
            </div>
            <div class="column-4-8 column-align">
                <img src="img/vanishing.png">
            </div>
            <div class="column-6-8 divider-bottom">
                <p>All in all, initializing your weights with inappropriate values will lead to divergence or slow-down in the training.</p>
            </div>
            <div class="column-6-8">
                <h3>How do we fix this issue?</h3>
                <p>Let's define our rule of thumb to translate the fact that we want the weights to be initialized neither “too big”, nor “too small”:</p>
                <p class="inline-caption">The variance should stay the same across every layer to prevent the signal from vanishing or exploding</p>
                <p>More concretely, consider a layer __ and its forward propagation:</p>
                <script>
                    var render = katex.renderToString("\\begin{aligned}a^{[l-1]} &= g^{[l-1]}(z^{[l-1]})\\cr z^{[l]} &= W^{[l]}a^{[l-1]} + b^{[l]}\\cr a^{[l]} &= g^{[l]}(z^{[l]}\\end{aligned}", {displayMode: true});
                    document.writeln(render);
                </script>
                <p>We would like the following to hold for all layers:</p>
                <script>
                    var render = katex.renderToString("Var(a^{[l-1]}) = Var(a^{[l]})", {displayMode: true});
                    document.writeln(render);
                </script>
                <p>In the visualization below, observe the impact of the weights’ distribution on each layer’s activations’ distribution.</p>
            </div>
            <div class="column-2-8 column-align">
                <h3>MNIST</h3>
                <p>Load MNIST test dataset (10,000 images).</p>
                <div>
                    <button class="button emphasized" id="load">
                        Load MNIST (<span id="percent">0%</span>)
                    </button>
                </div>
            </div>
            <div class="column-4-8 column-align">
                <h3>Hidden Layers</h3>
                <p>Select a distribution to initialize weights with.</p>
                <label class="radio-container">Zero
                    <input type="radio" value="zero" name="mnist">
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Uniform
                    <input type="radio" value="uniform" name="mnist">
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Xavier
                    <input type="radio" value="xe" name="mnist" checked>
                    <span class="checkmark"></span>
                </label>
                <label class="radio-container">Normal
                    <input type="radio" value="normal" name="mnist">
                    <span class="checkmark"></span>
                </label>
            </div>
            <div class="column-2-8 column-align">
                <h3>Softmax</h3>
                <p>Train model.</p>
                <div>
                    <button class="button" id="mnist_reset">Reset</button>
                    <button class="button" id="mnist_train">Train</button>
                    <!-- <button class="button" id="stop">stop</button> -->
                    <!-- <button class="button" id="step">step</button> -->
                </div>
            </div>

            <div class="column-2-8 column-align lg-screen-img">
                <div>
                    <p>Input Layer</p>
                    <div id="mnist"></div>
                    <label>
                    Batch: <span id="batch">0</span> 
                    Epoch: <span id="epoch">0</span>
                    </label>
                </div>
            </div>
            <div class="column-4-8 column-align lg-screen-img">

                <div id="hidden"></div>
            </div>
            <div class="column-2-8 column-align lg-screen-img">
                <div>
                    <p>Output Layer</p>
                    <div id="softmax"></div>
                    <label>
                    Accuracy: <span id="accuracy">0.00</span>
                    Loss: <span id="cost">0.00</span>
                    </label>
                </div>
            </div>
            <div class="column-6-8 column-align">
                <p>More precisely, Glorot et al. (2010) recommended to initialize your network’s parameters with:</p>
                <script>
                    var render = katex.renderToString("\\begin{aligned}W^{[l]} &\\sim Normal(\\mu=0,\\sigma^2 = \\frac{1}{n^{[l-1]}})\\cr b^{[l]} &\\sim 0\\end{aligned}", {displayMode: true});
                    document.writeln(render);
                </script>
                <p>This scheme is called Xavier initialization (click for more info (1)), and it’s the “appropriate initialization” in the visual above.</p>
                <img src="img/network.png">
            </div>
            <div class="column-2-8 column-align">
                <p class="caption">For more information check out Glorot et al. (2010) paper which introduced Xavier initialization.</p>
                <a href="http://proceedings.mlr.press/v9/glorot10a/glorot10a.pdf?hc_location=ufi"><img src="img/paper.png"></a>
            </div>
            <div class="column-6-8">
                <h3>Derivation of Xavier initialization</h3>
                <p>In this section, we will go over the math step by step. I think it sometimes help to understand the proof to grasp the concept, but you can get most of the intuition without the maths -> feel free to jump to the next part.</p>
            </div>
        </div>




<!--         <div class="full-container-image">
            <img src="img/image-placeholder.png">
            <div class="container">
                <div class="column-3-4">
                    <p class="img-caption">image caption</p>
                </div>
                <div class="column-6-8">
                    <h5>Default button</h5>
                    <button class="button">button</button>
                    <h5>Emphasized button</h5>
                    <button class="button emphasized">button</button>

                    <h5>Radio button</h5>
                    <label class="radio-container">One
                        <input type="radio" checked="checked" name="radio">
                        <span class="checkmark"></span>
                    </label>
                    <label class="radio-container">Two
                        <input type="radio" name="radio">
                        <span class="checkmark"></span>
                    </label>
                    <label class="radio-container">Three
                        <input type="radio" name="radio">
                        <span class="checkmark"></span>
                    </label>
                    <label class="radio-container">Four
                        <input type="radio" name="radio">
                        <span class="checkmark"></span>
                    </label>
                    <h5>Slider</h5> 
                    <input type="range" min="0" max="1" step="0.01" value="0.5">
                </div>
            </div>
        </div> -->
    </div>
    <div class="footer">
        <div class="container">
            <div class="column-2-8 column-align">
                <h4 class="reference">Authors</h4>
            </div>
            <div class="column-6-8 column-align">
                <ol class="reference">
                    <li>Writing - Kian Katanforoosh</li>
                    <li>Visualizations - Daniel Kunin</li>
                    <li>Design - Jingru Guo</li>
                </ol>
            </div>
            <div class="column-2-8 column-align">
                <h4 class="reference">Acknowledgments</h4>
            </div>
            <div class="column-6-8 column-align">
                <ol class="reference">
                    <li>Daniel Smilkov's and Shan Carter's Neural Network <a href="https://playground.tensorflow.org/">playground</a>.</li>
                    <li>Andrej Karpathy's <a href="https://cs.stanford.edu/~karpathy/mnistjs/">visualization</a> of MNIST.</li>
                </ol>
            </div>
            <div class="column-2-8 column-align">
                <h4 class="reference">Footnotes</h4>
            </div>
            <div class="column-6-8 column-align">
                <ol class="reference">
                    <li></li>
                    <li></li>
                </ol>
            </div>
        </div>
    </div>
</body>

<!-- PLAYGROUND -->
<!-- Main CSS -->
<link rel="stylesheet" href="css/playground.css">
<!-- Data Generattion Code -->
<script src="js/playground/data.js"></script>
<!-- Neural Network Code -->
<script src="js/playground/nn.js"></script>
<!-- Visualization Code -->
<script src="js/playground/viz.js"></script>


<!-- MNIST -->
<!-- Main CSS -->
<link rel="stylesheet" href="css/mnist.css">
<!-- Neural Network Code -->
<script src="js/mnist/nn.js"></script>
<!-- Data Zip Reader -->
<script src="js/mnist/zip/zip.js"></script>
<!-- Data Generattion Code -->
<script src="js/mnist/data.js"></script>
<!-- Visualization Code -->
<script src="js/mnist/viz.js"></script>
